{"version":3,"sources":["../../src/base.js"],"names":["plus","require","deprecate","TREE_OPTIONS","Chainer","VerbMethods","toPromise","SimpleVerbsPlugin","Requester","applyHypermedia","isBuffer","data","global","uncamelizeObj","obj","Array","isArray","map","i","Object","o","iterable","keys","j","length","key","value","uncamelize","OctokatBase","clientOptions","plugins","disableHypermedia","instance","request","method","path","options","raw","isBase64","isBoolean","cb","requester","err","val","context","_parseWithContext","verbMethods","chain","me","user","parse","Error","url","responseMiddlewareAsyncs","filter","responseMiddlewareAsync","plugin","bind","unshift","waterfall","_fromUrlWithDefault","defaultFn","args","injectVerbMethods","fromUrl","fetch","_fromUrlCurried","fn","templateArgs","apply","test","status","api","lastMessage","messages","module","exports"],"mappings":"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","file":"base.js","sourcesContent":["const plus = require('./plus')\nconst deprecate = require('./deprecate')\nconst TREE_OPTIONS = require('./grammar/tree-options')\nconst Chainer = require('./chainer')\nconst { VerbMethods, toPromise } = require('./verb-methods')\n\n// Use the following plugins by default (they should be neglegible additional code)\nconst SimpleVerbsPlugin = require('./plugins/simple-verbs')\n\nconst Requester = require('./requester')\nconst applyHypermedia = require('./helpers/hypermedia')\n\n// Checks if a response is a Buffer or not\nconst isBuffer = (data) => {\n  if (typeof global['Buffer'] !== 'undefined') {\n    return global['Buffer'].isBuffer(data)\n  } else {\n    // If `global` is not defined then we are not running inside Node so\n    // the object could never be a Buffer.\n    return false\n  }\n}\n\nlet uncamelizeObj = function (obj) {\n  if (Array.isArray(obj)) {\n    return (obj.map((i) => uncamelizeObj(i)))\n  } else if (obj === Object(obj)) {\n    let o = {}\n    let iterable = Object.keys(obj)\n    for (let j = 0; j < iterable.length; j++) {\n      let key = iterable[j]\n      let value = obj[key]\n      o[plus.uncamelize(key)] = uncamelizeObj(value)\n    }\n    return o\n  } else {\n    return obj\n  }\n}\n\nlet OctokatBase = function (clientOptions = {}) {\n  let plugins = clientOptions.plugins || [SimpleVerbsPlugin]\n\n  // TODO remove disableHypermedia\n  let {disableHypermedia} = clientOptions\n  // set defaults\n  if (typeof disableHypermedia === 'undefined' || disableHypermedia === null) { disableHypermedia = false }\n\n  // the octokat instance\n  let instance = {}\n\n  let request = function (method, path, data, options = {raw: false, isBase64: false, isBoolean: false}, cb) {\n    // replacer = new Replacer(request)\n\n    // Use a slightly convoluted syntax so browserify does not include the\n    // NodeJS Buffer in the browser version.\n    // data is a Buffer when uploading a release asset file\n    if (data && !isBuffer(data)) {\n      data = uncamelizeObj(data)\n    }\n\n    // For each request, convert the JSON into Objects\n    let requester = new Requester(instance, clientOptions, plugins)\n\n    return requester.request(method, path, data, options, function (err, val) {\n      if (err) { return cb(err) }\n      if ((options || {}).raw) { return cb(null, val) }\n\n      if (!disableHypermedia) {\n        let context = {\n          data: val,\n          plugins,\n          requester,\n          instance,\n          clientOptions\n        }\n        return instance._parseWithContext(path, context, cb)\n      } else {\n        return cb(null, val)\n      }\n    }\n    )\n  }\n\n  let verbMethods = new VerbMethods(plugins, {request});\n  (new Chainer(verbMethods)).chain('', null, TREE_OPTIONS, instance)\n\n  // Special case for `me`\n  instance.me = instance.user\n\n  instance.parse = function (cb, data) { // The signature of toPromise has cb as the 1st arg\n    let context = {\n      requester: {request},\n      plugins,\n      data,\n      instance,\n      clientOptions\n    }\n    return instance._parseWithContext('', context, cb)\n  }\n\n  // If not callback is provided then return a promise\n  instance.parse = toPromise(instance.parse)\n\n  instance._parseWithContext = function (path, context, cb) {\n    if (typeof cb !== 'function') { throw new Error('Callback is required') }\n    let { data } = context\n    if (data) {\n      context.url = data.url || path\n    }\n\n    let responseMiddlewareAsyncs = plus.map(plus.filter(plugins, ({responseMiddlewareAsync}) => responseMiddlewareAsync), plugin => plugin.responseMiddlewareAsync.bind(plugin)\n    )\n\n    // async.waterfall requires that the 1st entry take 0 arguments\n    responseMiddlewareAsyncs.unshift(cb => cb(null, context))\n    return plus.waterfall(responseMiddlewareAsyncs, function (err, val) {\n      if (err) { return cb(err, val) }\n      ({data} = val)\n      return cb(err, data)\n    }\n    )\n  }\n\n  // TODO remove this deprectaion too\n  instance._fromUrlWithDefault = function (path, defaultFn, ...args) {\n    path = applyHypermedia(path, ...args)\n    verbMethods.injectVerbMethods(path, defaultFn)\n    return defaultFn\n  }\n\n  instance.fromUrl = function (path, ...args) {\n    let defaultFn = function (...args) {\n      deprecate('call ....fetch() explicitly instead of ...()')\n      return defaultFn.fetch(...args)\n    }\n\n    return instance._fromUrlWithDefault(path, defaultFn, ...args)\n  }\n\n  instance._fromUrlCurried = function (path, defaultFn) {\n    let fn = function (...templateArgs) {\n      // This conditional logic is for the deprecated .nextPage() call\n      if (defaultFn && templateArgs.length === 0) {\n        return defaultFn.apply(fn)\n      } else {\n        return instance.fromUrl(path, ...templateArgs)\n      }\n    }\n\n    if (!/\\{/.test(path)) {\n      verbMethods.injectVerbMethods(path, fn)\n    }\n    return fn\n  }\n\n  // Add the GitHub Status API https://status.github.com/api\n  instance.status = instance.fromUrl('https://status.github.com/api/status.json')\n  instance.status.api = instance.fromUrl('https://status.github.com/api.json')\n  instance.status.lastMessage = instance.fromUrl('https://status.github.com/api/last-message.json')\n  instance.status.messages = instance.fromUrl('https://status.github.com/api/messages.json')\n\n  return instance\n}\n\nmodule.exports = OctokatBase\n"]}